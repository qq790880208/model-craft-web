(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-083b3cfe"],{1:function(e,i){},"13d5":function(e,i,t){"use strict";var o=t("23e7"),l=t("d58f").left,r=t("a640"),s=t("ae40"),n=r("reduce"),a=s("reduce",{1:0});o({target:"Array",proto:!0,forced:!n||!a},{reduce:function(e){return l(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},2:function(e,i){},"2c7b":function(e,i,t){"use strict";var o=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"ih-item"},[t("a",[t("div",[t("img",{style:{height:"200px",border:"3px solid "+this.markcolor},attrs:{src:e.imagesrc},on:{mousedown:e.entermark}})]),t("div",{staticClass:"info",staticStyle:{"{width":"100%"}},[t("h3",{staticStyle:{color:"rgba(255,255,255,1)"}},[e._v(e._s(e.ismarkedtext))])])])])},l=[],r=(t("a9e3"),{name:"",data:function(){return{input:""}},props:{fatherimagesrc:String,ismarked:{type:Number,default:!1},ishighlight:Boolean},destroyed:function(){console.log("miniimageddddddddddddddddddddddddddddddddddddddddddddddddddddd")},computed:{imagesrc:function(){return this.fatherimagesrc},markcolor:function(){return 1===this.ismarked?"#ff0000":"#ffffff"},ismarkedtext:function(){return 1===this.ismarked?"已标注":"未标注"}},methods:{kanurl:function(){console.log(this.imagesrc)},entermark:function(){console.log("entermark"),this.$emit("entermark")}},components:{}}),s=r,n=(t("36ef"),t("2877")),a=Object(n["a"])(s,o,l,!1,null,null,null);i["a"]=a.exports},3:function(e,i){},"36ef":function(e,i,t){"use strict";t("6a54")},"6a54":function(e,i,t){},"74e6":function(e,i,t){"use strict";t.r(i);var o=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticStyle:{"user-select":"none"}},[e.isimageview?t("div",{staticClass:"dashboard-container"},[t("div",[t("el-button",{on:{click:e.returndataset}},[e._v("返回数据集")]),t("el-button",{on:{click:e.generateXML}},[e._v("生成标注文件")]),e.isalllabeled?t("el-button",{on:{click:e.newlabel}},[e._v("申请新任务")]):e._e()],1),e._l(e.imagelargeArry,(function(i,o){return t("div",{key:o,staticStyle:{display:"inline-block","margin-left":"20px"}},[t("miniimage",{staticStyle:{"margin-top":"20px"},attrs:{fatherimagesrc:i.url,ismarked:i.islabel},on:{entermark:function(i){return e.entermark(o)}}})],1)}))],2):e._e(),e.isimageview?e._e():t("div",{staticClass:"dashboard-container",staticStyle:{"margin-left":"100px"}},[t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.returnimageview}},[e._v("保存并返回图片预览")]),t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.skipimagepre}},[e._v("上一张(A)")]),t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.previousimage}},[e._v("保存并上一张(S)")]),t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.nextimage}},[e._v("保存并下一张D)")]),t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.skipimagenext}},[e._v("下一张(F)")]),t("el-button",{attrs:{disabled:e.isdisablebutton},on:{click:e.nomarkedimage}},[e._v("无可标注类型(G)")]),t("drawpolygon",{ref:"drawpolygonref",staticStyle:{"margin-top":"20px"},attrs:{fatherimagesrc:this.imageArry[e.nownum],imageindex:this.nownum,premarktype:this.marktype,auditremakeinfo:this.auditinfoArry[e.nownum],acceptremakeinfo:this.acceptinfoArry[e.nownum],lastlabelArry:this.lastinfoArry[e.nownum]},on:{closebutton:e.closebutton,saveimageinfo:e.saveimageinfo}})],1)])},l=[],r=t("5530"),s=(t("b0c0"),t("2f62")),n=t("7e1e"),a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"polygon-body",staticStyle:{width:"100%"}},[t("div",[t("div",{style:{marginLeft:(this.divWidth-650)/2+"px",display:"block"}},[t("el-switch",{staticStyle:{display:"inline-block"},attrs:{"active-text":"选择标签后标注","inactive-text":"先标注后选标签","active-color":"#13ce66","inactive-color":"#ff4949",disabled:e.islabeling},on:{change:e.switchchange},model:{value:e.markstyle,callback:function(i){e.markstyle=i},expression:"markstyle"}}),t("el-radio-group",{staticStyle:{display:"inline-block"},attrs:{disabled:e.lockradio},model:{value:e.radio,callback:function(i){e.radio=i},expression:"radio"}},[t("el-radio-button",{attrs:{label:"pointmark"}},[e._v("点标注")]),t("el-radio-button",{attrs:{label:"linemark"}},[e._v("线标注")]),t("el-radio-button",{attrs:{label:"polygonmark"}},[e._v("多边形标注")]),t("el-radio-button",{attrs:{label:"rectanglemark"}},[e._v("矩形标注")]),t("el-radio-button",{attrs:{label:"ellipsemark"}},[e._v("椭圆标注")]),t("el-radio-button",{attrs:{label:"drag"}},[e._v("拖动")]),t("el-radio-button",{attrs:{label:"modify"}},[e._v("修改")])],1),t("el-button-group",{staticStyle:{display:"inline-block"}},[t("el-button",{style:{width:"80px"},attrs:{icon:"el-icon-zoom-in"},on:{click:e.fangda}}),t("el-button",{style:{width:"80px"},attrs:{icon:"el-icon-zoom-out"},on:{click:e.suoxiao}}),t("el-button",{style:{width:"80px"},attrs:{icon:"el-icon-refresh"},on:{click:e.huanyuan}})],1)],1),t("el-dialog",{style:{width:"800px",marginLeft:e.dialogleft+"px",marginTop:e.dialogtop+"px"},attrs:{title:"提示",visible:e.dialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(i){e.dialogVisible=i}}},[t("span",[e._v("请选择标签")]),t("el-select",{ref:"selectref",staticStyle:{width:"100px"},attrs:{filterable:"",placeholder:" "},on:{change:e.changeinfo2},model:{value:e.markinfo,callback:function(i){e.markinfo=i},expression:"markinfo"}},e._l(e.premarktype,(function(e){return t("el-option",{key:e.index,attrs:{label:e.name,value:e}})})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelmark}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.makemark}},[e._v("确 定")])],1)],1)],1),t("div",{style:{display:"flex"}},[t("div",{ref:"outdiv",style:{maxWidth:"1000px",maxHeight:"1000px"},attrs:{id:"leftdiv"}},[t("div",{staticClass:"polygon",style:{},on:{mouseenter:e.fangdasuoxiaochange1,mouseleave:e.fangdasuoxiaochange2,mousewheel:function(e){e.preventDefault()}}},[t("canvas",{staticClass:"canvas",attrs:{id:"label-canvas"}})]),t("div",{staticStyle:{display:"inline-block"},attrs:{id:"remarkinfodiv"}},[t("div",[t("p",[e._v("驳回备注："+e._s(e.auditremakeinfo))])]),t("div",[t("p",[e._v("验收备注："+e._s(e.acceptremakeinfo))])])])]),t("div",{staticClass:"el-divider el-divider--vertical"}),t("div",{attrs:{id:"rightdiv"}},[t("div",{ref:"tagdiv",staticClass:"infopolygon",style:e.setheightTag},e._l(e.premarktype,(function(i,o){return t("div",{key:o,staticStyle:{float:"left","margin-right":"20px"}},[t("el-button",{style:{width:"120px",marginBottom:"10px",background:e.markstyle?e.buttonindex==o?i.color:"rgba(0,0,0,0)":i.color},attrs:{disabled:!e.markstyle},on:{click:function(t){return e.changeinfo(i,o)}}},[e._v(e._s(i.name))])],1)})),0),t("el-divider"),t("div",{ref:"infodiv",staticClass:"infopolygon",style:e.setheightInfo},e._l(e.allobjArray,(function(i,o){return t("div",{key:o,staticStyle:{"margin-right":"20px"}},[t("div",{style:{width:"400px",height:"160px",marginTop:"10px",border:e.b_i===o?"3px solid #ff0000":"0px solid #ff0000",background:i.color},on:{mousedown:function(t){return e.handelClick(i,o)}}},[t("div",{staticStyle:{width:"300px","margin-top":"10px",display:"inline-block"}},[t("p",{style:{marginLeft:"30px",marginTop:"10px",width:"300px",fontSize:"20px",display:"inline-block"}},[e._v(" "+e._s("polygon"==i.type?"多边形":"line"==i.type?"线":"point"==i.type?"点":"rectangle"==i.type?"矩形":"椭圆形")+" "+e._s(i.info)+" ")]),t("el-select",{ref:"selectchangeref",refInFor:!0,staticStyle:{width:"300px","margin-left":"30px",display:"block"},attrs:{filterable:"",placeholder:" ",disabled:!e.allowchangebi},on:{"visible-change":function(t){return e.forceSelect(i,o,t)},change:function(t){return e.changeinfo3(i,o,t)}},model:{value:i.info,callback:function(t){e.$set(i,"info",t)},expression:"items.info"}},e._l(e.premarktype,(function(e){return t("el-option",{key:e.index,attrs:{label:e.name,value:e}})})),1)],1),e.b_i!==o||0!=e.allowchangebi?t("el-button",{style:{width:"100px",height:"35px",marginTop:"10px",marginBottom:"10px",marginLeft:"75px",display:"inline-block"},attrs:{type:"warning",disabled:!e.allowchangebi},nativeOn:{mouseup:function(t){return e.editone(i)},mousedown:function(t){return e.forceSelect(i,o,"button")}}},[e._v("修改 ")]):e._e(),e.b_i===o&&0==e.allowchangebi?t("el-button",{style:{width:"100px",height:"35px",marginTop:"10px",marginBottom:"10px",marginLeft:"75px",display:"inline-block"},attrs:{type:"warning"},nativeOn:{mouseup:function(t){return e.finishone(i)}}},[e._v("完成修改 ")]):e._e(),t("el-button",{style:{width:"100px",height:"35px",marginTop:"10px",marginBottom:"10px",marginLeft:"50px",display:"inline-block"},attrs:{type:"danger",disabled:!e.allowchangebi},nativeOn:{mouseover:function(i){return e.infotip(o)},mouseout:function(i){return e.removetip(o)},mouseup:function(i){return e.deletemarked(o)}}},[e._v("删除 ")])],1)])})),0)],1)])])},c=[],h=t("53ca"),f=(t("a9e3"),t("159b"),t("13d5"),t("cb29"),t("a434"),t("7a94"));function g(e,i,t){var o=t.points[this.pointIndex].x-t.pathOffset.x,l=t.points[this.pointIndex].y-t.pathOffset.y;return f["fabric"].util.transformPoint({x:o,y:l},f["fabric"].util.multiplyTransformMatrices(t.canvas.viewportTransform,t.calcTransformMatrix()))}function d(e,i,t){return console.log("interanchorWrapper",t),function(o,l,r,s){var n=l.target,a=f["fabric"].util.transformPoint({x:n.points[e].x-n.pathOffset.x,y:n.points[e].y-n.pathOffset.y},n.calcTransformMatrix()),c=i(o,l,r,s,t),h=(n._setPositionDimensions({}),n._getNonTransformedDimensions()),g=(n.points[e].x-n.pathOffset.x)/h.x,d=(n.points[e].y-n.pathOffset.y)/h.y;return n.setPositionByOrigin(a,g+.5,d+.5),c}}function b(e,i,t,o,l){var r=i.target,s=r.controls[r.__corner],n=r.toLocalPoint(new f["fabric"].Point(t,o),"center","center"),a=r._getNonTransformedDimensions(),c=r._getTransformedDimensions(0,0),h={x:n.x*a.x/c.x+r.pathOffset.x,y:n.y*a.y/c.y+r.pathOffset.y};return r.points[s.pointIndex]=h,!0}var y={props:{fatherimagesrc:String,imageindex:Number,premarktype:{type:Array,default:function(){return[]}},auditremakeinfo:{type:String,default:""},acceptremakeinfo:{type:String,default:""},lastlabelArry:{type:Object,default:function(){}},canvaswidth:{type:Number,default:600},canvasheight:{type:Number,default:600}},data:function(){return{divWidth:1e3,divHeight:750,mountedFlag:!0,setheightTag:{marginTop:"20px",marginLeft:"20px",height:""},setheightInfo:{marginLeft:"20px",height:""},radio:"polygonmark",markstyle:!0,dialogVisible:!1,dialogleft:0,dialogtop:0,markcolor2:"rgba(0,128,128,0.5)",markinfo2:null,mousePointerEvent:null,b_i:"",allowchangebi:!0,lockradio:!1,temitem:null,fangdasuoxiaoFlag:!1,buttonindex:-1,input:null,temproof:null,roof:null,line:null,cicle:null,rectangle:null,ellipse:null,panning:!1,zoom:1,islabeling:!1,allobjArray:[],temtwopoint:[],testcirclearray:[],generateline:[],temlineobj:null,imagechangebtntext:"修改图形",isimagechange:!1,imagewidth:null,imageheight:null,scalewidth:null,scaleheight:null,distanceDelta:0,linePoints:[],realLinePoints:[],circlePoints:[],rectanglePoints:[],ellipsePoints:[],realCirclePoints:[],roofPoints:[],realPoints:[],realRectanglePoints:[],realEllipsePoints:[],temRectangle:[],temEllipse:[],temlines:[],temlineCounter:0,temcircles:[],temcircleCounter:0,llines:[],llinesCounter:0,lineArray:[],lineinfoArray:[],reallineinfoArray:[],circleArray:[],circleinfoArray:[],realcircleinfoArray:[],polygonArray:[],polygoninfoArray:[],realpolygoninfoArray:[],rectangleArray:[],rectangleinfoArray:[],realrectangleinfoArray:[],ellipseArray:[],ellipseinfoArray:[],realellipseinfoArray:[],fabricObj:null,fabricimageObj:null,canvas:null,Point:{},markcolor:"rgba(0,128,128,0.5)",markinfo:null,buttonmouseoveflag:!1}},computed:{imagesrc:function(){return this.fatherimagesrc}},destroyed:function(){window.removeEventListener("resize",this.GetWindowInfo),window.removeEventListener("mousewheel",this.checkFangdasSuoxiao)},mounted:function(){var e=this;this.emitfather(),window.addEventListener("resize",this.GetWindowInfo),window.addEventListener("mousewheel",this.checkFangdasSuoxiao,!0),this.GetWindowInfo(),this.mountedFlag=!1,this.$nextTick((function(){setTimeout((function(){e.fabricObj=new f["fabric"].Canvas("label-canvas"),e.fabricObj.selection=!1,e.fabricEvent(),e.createBackgroundImage()}),500),setTimeout((function(){e.updatelastdata(),console.log("wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww",e.fabricObj.width),e.huanyuan()}),520),setTimeout((function(){e.GetWindowInfo()}),550)}))},watch:{imagesrc:function(){var e=this;this.emitfather(),console.log("watch!!!!!!!!"),this.buttonindex=-1,this.createBackgroundImage(),setTimeout((function(){e.polygonArray.forEach((function(i){e.fabricObj.remove(i)})),e.lineArray.forEach((function(i){e.fabricObj.remove(i)})),e.circleArray.forEach((function(i){e.fabricObj.remove(i)})),e.rectangleArray.forEach((function(i){e.fabricObj.remove(i)})),e.ellipseArray.forEach((function(i){e.fabricObj.remove(i)})),e.clearinfo(),e.clearobj(),e.isimagechange&&e.Edit(),e.updatelastdata(),e.huanyuan(),e.markinfo=null,e.markcolor=e.markcolor2,e.buttonindex=-1}),20)},radio:function(){this.start()}},methods:{editone:function(e){if(this.allowchangebi){var i=this.b_i;if(this.lockradio=!0,this.allowchangebi=!1,this.emitfather(),this.clearobj(),this.b_i=i,this.deleteBorder(e),console.log("upuppupsaudsaiodhchbzxjkvb",this.allowchangebi),"polygon"==e.type){var t=this.polygonArray.indexOf(e),o=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[t])];console.log(t,o);var l=this;o.edit=!0,o.selectable=!0,console.log("poly.edit",o.edit),console.log("poly.selectable",o.selectable);var r=o.points.length-1;o.cornerStyle="circle",o.cornerColor="rgba(0,128,255,0.8)",this.fabricObj.setActiveObject(o),console.log(r),o.controls=o.points.reduce((function(e,i,t){return e[t]=new f["fabric"].Control({positionHandler:g,actionHandler:d(t>0?t-1:r,b,l.fabricObj),actionName:"modifyPolygon",pointIndex:t}),e}),{})}else if("line"==e.type){var s=this.lineArray.indexOf(e);this.fabricObj.add(this.testcirclearray[2*s]),this.fabricObj.add(this.testcirclearray[2*s+1])}else if("point"==e.type){var n=this.circleArray.indexOf(e),a=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[n])];this.fabricObj.setActiveObject(a),a.selectable=!0,a.hasBorders=!0}else if("rectangle"==e.type){var c=this.rectangleArray.indexOf(e),h=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[c])];this.fabricObj.setActiveObject(h),h.selectable=!0,h.hasBorders=!0,h.hasControls=!0,h.lockMovementX=!1,h.lockMovementY=!1,h.hasRotatingPoint=!1}else if("ellipse"==e.type){var y=this.ellipseArray.indexOf(e),p=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[y])];this.fabricObj.setActiveObject(p),p.selectable=!0,p.hasBorders=!0,p.hasControls=!0,p.lockMovementX=!1,p.lockMovementY=!1,p.hasRotatingPoint=!1}this.fabricObj.renderAll()}},finishone:function(e){if(this.allowchangebi=!0,this.lockradio=!1,this.emitfather(),"polygon"==e.type){var i=this.polygonArray.indexOf(e);console.log("polygoninfoArray",this.polygoninfoArray[i]),console.log("realpolygoninfoArray",this.realpolygoninfoArray[i]),console.log("polygonArray",this.polygonArray[i].points),console.log("this.fabricObj.getObjects()[i]",this.fabricObj.getObjects()[i]);var t=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[i])];this.fabricObj.discardActiveObject(t),t.edit=!1,t.selectable=!1,this.realPoints=[];for(var o=0;o<this.polygoninfoArray[i].point.length;o++){console.log("point!!!!!!!!!",this.polygoninfoArray[i].point[o]);var l={};l["x"]=this.polygonArray[i].points[o].x/this.scalewidth,l["y"]=this.polygonArray[i].points[o].y/this.scaleheight,this.realPoints.push(l)}this.realpolygoninfoArray[i].point=this.realPoints}else if("line"==e.type){var r=this.lineArray.indexOf(e);this.fabricObj.remove(this.testcirclearray[2*r]),this.fabricObj.remove(this.testcirclearray[2*r+1])}else if("point"==e.type){var s=this.circleArray.indexOf(e),n=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[s])];n.edit=!1,n.selectable=!1,this.fabricObj.discardActiveObject(n)}else if("rectangle"==e.type){var a=this.rectangleArray.indexOf(e),c=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[a])];c.selectable=!1,c.hasControls=!1,this.fabricObj.discardActiveObject(c)}else if("ellipse"==e.type){var h=this.ellipseArray.indexOf(e),f=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[h])];f.selectable=!1,f.hasControls=!1,this.fabricObj.discardActiveObject(f)}this.getBorder(e),this.fabricObj.renderAll()},forceSelect:function(e,i,t){console.log("e",e,i,t),1==t?(this.b_i!=i&&(this.b_i=i,this.getBorder(e)),console.log("fsdfsfdsfdfsdfsdf "+e.type)):0==t?(this.deleteBorder(e),this.b_i=-1):"button"==t&&(this.b_i==i&&(this.b_i=-1),console.log("button"))},forceUnselect:function(e,i){this.deleteBorder(e),this.b_i=-1},handelClick:function(e,i){this.allowchangebi&&(this.b_i!=i?(this.b_i=i,this.getBorder(e)):(this.deleteBorder(e),this.b_i=-1)),console.log("hahaha"+e.type)},getBorder:function(e){if(this.temitem=e,"polygon"==e.type){var i=this.polygonArray.indexOf(e),t=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[i])];console.log(i,t),t.hasBorders=!0,t.hasControls=!1,t.selectable=!1,t.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.setActiveObject(t),this.fabricObj.renderAll()}else if("line"==e.type){var o=this.lineArray.indexOf(e),l=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.lineArray[o])];console.log(o,l),l.hasBorders=!0,l.hasControls=!1,l.selectable=!1,l.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.setActiveObject(l),this.fabricObj.renderAll()}else if("point"==e.type){var r=this.circleArray.indexOf(e),s=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[r])];console.log(r,s),s.hasBorders=!0,s.hasControls=!1,s.selectable=!1,s.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.setActiveObject(s),this.fabricObj.renderAll()}else if("rectangle"==e.type){var n=this.rectangleArray.indexOf(e),a=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[n])];console.log(n,a),a.hasBorders=!0,a.hasControls=!1,a.selectable=!1,a.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.setActiveObject(a),this.fabricObj.renderAll()}else if("ellipse"==e.type){var c=this.ellipseArray.indexOf(e),h=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[c])];console.log(c,h),h.hasBorders=!0,h.hasControls=!1,h.selectable=!1,h.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.setActiveObject(h),this.fabricObj.renderAll()}},deleteBorder:function(e){if(this.temitem=null,"polygon"==e.type){var i=this.polygonArray.indexOf(e),t=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[i])];console.log(i,t),t.hasBorders=!1,t.hasControls=!0,t.selectable=!1,t.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.discardActiveObject(t),this.fabricObj.renderAll()}else if("line"==e.type){var o=this.lineArray.indexOf(e),l=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.lineArray[o])];console.log(o,l),l.hasBorders=!1,l.hasControls=!1,l.selectable=!1,l.set({lockMovementX:!0,lockMovementY:!0}),this.fabricObj.discardActiveObject(l),this.fabricObj.renderAll()}else if("point"==e.type){var r=this.circleArray.indexOf(e),s=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[r])];console.log(r,s),s.hasBorders=!1,s.hasControls=!1,s.selectable=!1,s.set({lockMovementX:!1,lockMovementY:!1}),this.fabricObj.discardActiveObject(s),this.fabricObj.renderAll()}else if("rectangle"==e.type){var n=this.rectangleArray.indexOf(e),a=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[n])];console.log(n,a),a.hasBorders=!1,a.hasControls=!0,a.selectable=!1,a.set({lockMovementX:!1,lockMovementY:!1}),this.fabricObj.discardActiveObject(a),this.fabricObj.renderAll()}else if("ellipse"==e.type){var c=this.ellipseArray.indexOf(e),h=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[c])];console.log(c,h),h.hasBorders=!1,h.hasControls=!0,h.selectable=!1,h.set({lockMovementX:!1,lockMovementY:!1}),this.fabricObj.discardActiveObject(h),this.fabricObj.renderAll()}},cancelbi:function(){this.b_i=-1},fangdasuoxiaochange1:function(){console.log("enter!!!!!"),this.fangdasuoxiaoFlag=!0},fangdasuoxiaochange2:function(){console.log("leave!!!!!"),this.fangdasuoxiaoFlag=!1},makemark:function(){null!=this.markinfo?("polygonmark"==this.radio?(this.islabeling&&(this.emitfather(),this.islabeling=!1),this.makePolygon()):"linemark"==this.radio?(this.islabeling&&(this.emitfather(),this.islabeling=!1),this.makeLineObj(this.mousePointerEvent)):"pointmark"==this.radio?this.makePointObj(this.mousePointerEvent):"rectanglemark"==this.radio?(this.islabeling&&(this.emitfather(),this.islabeling=!1),this.makeRectangleObj(this.mousePointerEvent)):"ellipsemark"==this.radio&&(this.islabeling&&(this.emitfather(),this.islabeling=!1),this.makeEllipseObj(this.mousePointerEvent)),this.switchchange(),this.dialogVisible=!1):this.cancelmark()},cancelmark:function(){this.clearobj(),this.switchchange(),this.dialogVisible=!1},checkFangdasSuoxiao:function(e){var i=e.deltaY>0?"down":"up";this.fangdasuoxiaoFlag&&("up"==i?this.fangda():this.suoxiao())},GetWindowInfo:function(){window.innerWidth>1650?this.divWidth=1e3:window.innerWidth>800?this.divWidth=1e3-(1650-window.innerWidth):this.divWidth=500,window.innerHeight>930?this.divHeight=750:window.innerHeight>450?this.divHeight=750-(930-window.innerHeight):this.divHeight=375,this.mountedFlag||(this.fabricObj.setWidth(this.divWidth),this.fabricObj.setHeight(this.divHeight),this.setheightTag.height=.25*this.divHeight+"px",this.setheightInfo.height=.75*this.divHeight+"px",console.log("asduisafhiasfb",this.divHeight))},Edit:function(){var e=this;if(this.isimagechange){console.log("this.ellipseArray",this.ellipseArray),this.allowchangebi=!0,this.isimagechange=!1,this.fabricObj.hoverCursor="default",this.clearobj(),this.testcirclearray.forEach((function(i){return e.fabricObj.remove(i)})),this.imagechangebtntext="修改图形",console.log("realpolygoninfoArray",this.realpolygoninfoArray),this.realpolygoninfoArray=[];for(var i=0;i<this.circleArray.length;i++){var t=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[i])];console.log("(^o^)/~6(^o^)/~6(^o^)/~6",t,i),this.fabricObj.discardActiveObject(t),t.edit=!1,t.selectable=!1}for(var o=0;o<this.rectangleArray.length;o++){var l=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[o])];console.log("uyfioaufasufopaisfasfuoaspoufaspioufiasufioasfuasufiasfisadosuaidhnzjkczxbcvn",l,o),this.fabricObj.discardActiveObject(l),l.selectable=!1,l.hasControls=!1}for(var r=0;r<this.ellipseArray.length;r++){var s=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[r])];console.log("umv34ut 483909ymv9u4h finh jkfjksdbfsdn",s,r),this.fabricObj.discardActiveObject(s),s.selectable=!1,s.hasControls=!1}for(var n=0;n<this.polygonArray.length;n++){console.log("polygoninfoArray",this.polygoninfoArray[n]),console.log("realpolygoninfoArray",this.realpolygoninfoArray[n]),console.log("polygonArray",this.polygonArray[n].points),console.log("this.fabricObj.getObjects()[i]",this.fabricObj.getObjects()[n]);var a=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[n])];this.fabricObj.discardActiveObject(a),a.edit=!1,a.selectable=!1,this.realPoints=[];for(var c=0;c<this.polygoninfoArray[n].point.length;c++){console.log("point!!!!!!!!!",this.polygoninfoArray[n].point[c]);var h={};h["x"]=this.polygonArray[n].points[c].x/this.scalewidth,h["y"]=this.polygonArray[n].points[c].y/this.scaleheight,this.realPoints.push(h)}this.realpolygoninfoArray.push({point:this.realPoints,info:this.polygoninfoArray[n].info})}console.log("uppppppppppppdateeeeeeeeeeeee",this.realpolygoninfoArray)}else{var y;(function(){null!=e.temitem&&e.deleteBorder(e.temitem),e.allowchangebi=!1,console.log("caonima",e.fabricObj._objects),console.log("caonimarectangleArray",e.rectangleArray),e.fabricObj.hoverCursor="move",e.isimagechange=!0,e.clearobj(),e.imagechangebtntext="正在修改图形";for(var i=e,t=0;t<e.polygonArray.length;t++){var o=e.fabricObj.getObjects()[e.fabricObj._objects.indexOf(e.polygonArray[t])];console.log("tuj904ut420tjh4io3h",o,t),o.edit=!0,o.selectable=!0,console.log("poly.edit",o.edit),console.log("poly.selectable",o.selectable),y=o.points.length-1,o.cornerStyle="circle",o.cornerColor="rgba(0,0,255,0.5)",console.log(y),o.controls=o.points.reduce((function(e,t,o){return e[o]=new f["fabric"].Control({positionHandler:g,actionHandler:d(o>0?o-1:y,b,i.fabricObj),actionName:"modifyPolygon",pointIndex:o}),e}),{})}for(var l=0;l<e.testcirclearray.length;l++)e.fabricObj.add(e.testcirclearray[l]);for(var r=0;r<e.circleArray.length;r++){var s=e.fabricObj.getObjects()[e.fabricObj._objects.indexOf(e.circleArray[r])];console.log("6547654756u56uj56u",s,r),s.selectable=!0}for(var n=0;n<e.rectangleArray.length;n++){var a=e.fabricObj.getObjects()[e.fabricObj._objects.indexOf(e.rectangleArray[n])];console.log("789787897897897564564564564654564564654",a,n),a.selectable=!0,a.hasBorders=!0,a.hasControls=!0,a.lockMovementX=!1,a.lockMovementY=!1}for(var c=0;c<e.ellipseArray.length;c++){var h=e.fabricObj.getObjects()[e.fabricObj._objects.indexOf(e.ellipseArray[c])];console.log("i0dhid9sdsubgdjsibdjsnklsdjvlknvodshvdiuh",h,c),h.selectable=!0,h.hasBorders=!0,h.hasControls=!0,h.lockMovementX=!1,h.lockMovementY=!1}console.log("this.ellipseArray",e.ellipseArray)})()}this.fabricObj.renderAll(),this.emitfather()},clearobj:function(){var e=this;this.islabeling&&(this.emitfather(),this.islabeling=!1),this.temlines.forEach((function(i){return e.fabricObj.remove(i)})),this.temcircles.forEach((function(i){return e.fabricObj.remove(i)})),this.llines.forEach((function(i){return e.fabricObj.remove(i)})),this.temRectangle.forEach((function(i){return e.fabricObj.remove(i)})),this.temEllipse.forEach((function(i){return e.fabricObj.remove(i)})),this.roofPoints=[],this.realPoints=[],this.linePoints=[],this.realLinePoints=[],this.rectanglePoints=[],this.realRectanglePoints=[],this.ellipsePoints=[],this.realEllipsePoints=[],this.temlines=[],this.temcircles=[],this.llines=[],this.temRectangle=[],this.temEllipse=[],this.temlineCounter=0,this.temcircleCounter=0,this.b_i=-1,console.log("count",this.testcirclearray.length,"objarr",this.testcirclearray),this.testcirclearray.length%2==1&&this.testcirclearray.length>0&&(console.log("delete one"),this.testcirclearray.pop())},clearinfo:function(){this.allobjArray=[],this.polygonArray=[],this.polygoninfoArray=[],this.realpolygoninfoArray=[],this.lineArray=[],this.lineinfoArray=[],this.reallineinfoArray=[],this.circleArray=[],this.circleinfoArray=[],this.realcircleinfoArray=[],this.rectangleArray=[],this.rectangleinfoArray=[],this.realrectangleinfoArray=[],this.ellipseArray=[],this.ellipseinfoArray=[],this.realellipseinfoArray=[],this.testcirclearray=[]},emitfather:function(){console.log("sonemit"),this.$emit("closebutton")},fangda:function(){var e=new f["fabric"].Point(this.divWidth/2,this.divHeight/2);this.zoom<4.99&&(this.zoom+=.1),this.fabricObj.zoomToPoint(e,this.zoom)},suoxiao:function(){var e=new f["fabric"].Point(this.divWidth/2,this.divHeight/2);this.zoom>.2&&(this.zoom-=.1),this.zoom>.1&&this.fabricObj.zoomToPoint(e,this.zoom)},huanyuan:function(){this.zoom=1,this.fabricObj.setZoom(1);var e=new f["fabric"].Point(0,0);this.fabricObj.absolutePan(e),this.fabricObj.relativePan(this.distanceDelta)},changeinfo:function(e,i){console.log("changeinfo",i),this.buttonindex=i,this.markcolor=e.color,this.markinfo=e.name},changeinfo2:function(e){console.log("changeinfo2",e),this.markcolor=e.color,this.markinfo=e.name},changeinfo3:function(e,i,t){if(console.log("item",e),console.log("item1",t),"polygon"==e.type){e.info=t.name,e.color=t.color;var o=this.polygonArray.indexOf(e),l=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.polygonArray[o])];l.set({fill:t.color}),this.polygoninfoArray[o].info=t.name,this.realpolygoninfoArray[o].info=t.name}else if("line"==e.type){e.info=t.name,e.color=t.color;var r=this.lineArray.indexOf(e),s=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.lineArray[r])];s.set({stroke:t.color}),this.lineinfoArray[r].info=t.name,this.reallineinfoArray[r].info=t.name}else if("point"==e.type){e.info=t.name,e.color=t.color;var n=this.circleArray.indexOf(e),a=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.circleArray[n])];a.set({fill:t.color}),this.circleinfoArray[n].info=t.name,this.realcircleinfoArray[n].info=t.name}else if("rectangle"==e.type){e.info=t.name,e.color=t.color;var c=this.rectangleArray.indexOf(e),h=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.rectangleArray[c])];h.set({fill:t.color}),this.rectangleinfoArray[c].info=t.name,this.realrectangleinfoArray[c].info=t.name}else if("ellipse"==e.type){e.info=t.name,e.color=t.color;var f=this.ellipseArray.indexOf(e),g=this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.ellipseArray[f])];g.set({fill:t.color}),this.ellipseinfoArray[f].info=t.name,this.realellipseinfoArray[f].info=t.name}this.fabricObj.renderAll()},switchchange:function(){this.buttonindex=-1,this.markcolor=this.markcolor2,this.markinfo=null},saveinfo:function(e,i){var t={};t.polygon=JSON.parse(JSON.stringify(this.realpolygoninfoArray)),t.line=JSON.parse(JSON.stringify(this.reallineinfoArray)),t.circle=JSON.parse(JSON.stringify(this.realcircleinfoArray)),t.rectangle=JSON.parse(JSON.stringify(this.realrectangleinfoArray)),t.ellipse=JSON.parse(JSON.stringify(this.realellipseinfoArray)),console.log("11111",t),this.$emit("saveimageinfo",t,this.imageindex,e,i),t=[],console.log("22222",t)},updatelastdata:function(){var e=this;if(console.log("image select lastlabelArry",this.lastlabelArry),console.log("remarkinfo",this.auditremakeinfo,this.acceptremakeinfo),this.b_i=-1,console.log("img11111111111111111",this.scalewidth,this.scaleheight),void 0!=this.lastlabelArry.line&&null!=this.lastlabelArry.line)for(var i=0;i<this.lastlabelArry.line.length;i++){for(var t=0;t<this.lastlabelArry.line[i].point.length;t++){console.log("point",this.lastlabelArry.line[i].point[t]);var o={},l={};o["x"]=this.lastlabelArry.line[i].point[t].x*this.scalewidth,o["y"]=this.lastlabelArry.line[i].point[t].y*this.scaleheight,l["x"]=this.lastlabelArry.line[i].point[t].x,l["y"]=this.lastlabelArry.line[i].point[t].y,this.linePoints.push(o),this.realLinePoints.push(l),this.makeLineEndPoint(o)}this.markinfo=this.lastlabelArry.line[i].info,this.findcolor(this.lastlabelArry.line[i].info),this.lineinfoArray.push({point:this.linePoints,info:this.markinfo}),this.reallineinfoArray.push({point:this.realLinePoints,info:this.markinfo}),console.log("linePoints",this.linePoints),this.makeLine(this.linePoints),this.fabricObj.add(this.line),this.lineArray.push(this.line),this.allobjArray.push(this.line),this.linePoints=[],this.realLinePoints=[],this.markinfo=null}if(void 0!=this.lastlabelArry.polygon&&null!=this.lastlabelArry.polygon)for(var r=0;r<this.lastlabelArry.polygon.length;r++){this.realpolygoninfoArray.push(this.lastlabelArry.polygon[r]),this.markinfo=this.lastlabelArry.polygon[r].info,console.log("lastlabelArry[i].point",this.lastlabelArry.polygon[r].point);for(var s=0;s<this.lastlabelArry.polygon[r].point.length;s++){console.log("point",this.lastlabelArry.polygon[r].point[s]);var n={};n["x"]=this.lastlabelArry.polygon[r].point[s].x*this.scalewidth,n["y"]=this.lastlabelArry.polygon[r].point[s].y*this.scaleheight,this.roofPoints.push(n)}console.log("roofPoint",this.roofPoints),console.log("this.lastlabelArry[i].info",this.lastlabelArry.polygon[r].info),this.findcolor(this.lastlabelArry.polygon[r].info),this.makeRoof(),console.log("this.roof",this.roof),this.fabricObj.add(this.roof),this.polygonArray.push(this.roof),this.allobjArray.push(this.roof),this.polygoninfoArray.push({point:this.roofPoints,info:this.markinfo}),this.markinfo=null,console.log("create 1"),console.log("roofPointsuuu",this.roofPoints),this.roofPoints=[]}if(void 0!=this.lastlabelArry.rectangle&&null!=this.lastlabelArry.rectangle)for(var a=0;a<this.lastlabelArry.rectangle.length;a++){console.log("rectangle1",this.lastlabelArry.rectangle[a]);for(var c=0;c<this.lastlabelArry.rectangle[a].point.length;c++){console.log("rectangle2",this.lastlabelArry.rectangle[a].point[c]);var h={},g={};h["x"]=this.lastlabelArry.rectangle[a].point[c].x*this.scalewidth,h["y"]=this.lastlabelArry.rectangle[a].point[c].y*this.scaleheight,g["x"]=this.lastlabelArry.rectangle[a].point[c].x,g["y"]=this.lastlabelArry.rectangle[a].point[c].y,this.rectanglePoints.push(h),this.realRectanglePoints.push(g)}this.markinfo=this.lastlabelArry.rectangle[a].info,this.findcolor(this.lastlabelArry.rectangle[a].info),this.makeRectangle(),this.rectangleArray.push(this.rectangle),this.allobjArray.push(this.rectangle),this.rectangleinfoArray.push({point:this.rectanglePoints,info:this.markinfo}),this.realrectangleinfoArray.push({point:this.realRectanglePoints,info:this.markinfo}),this.fabricObj.add(this.rectangle),this.rectanglePoints=[],this.realRectanglePoints=[],this.rectangle=null}if(void 0!=this.lastlabelArry.ellipse&&null!=this.lastlabelArry.ellipse)for(var d=0;d<this.lastlabelArry.ellipse.length;d++){console.log("ellipse1",this.lastlabelArry.ellipse[d]);for(var b=0;b<this.lastlabelArry.ellipse[d].point.length;b++){console.log("ellipse2",this.lastlabelArry.ellipse[d].point[b]);var y={},p={};y["x"]=this.lastlabelArry.ellipse[d].point[b].x*this.scalewidth,y["y"]=this.lastlabelArry.ellipse[d].point[b].y*this.scaleheight,p["x"]=this.lastlabelArry.ellipse[d].point[b].x,p["y"]=this.lastlabelArry.ellipse[d].point[b].y,this.ellipsePoints.push(y),this.realEllipsePoints.push(p)}this.markinfo=this.lastlabelArry.ellipse[d].info,this.findcolor(this.lastlabelArry.ellipse[d].info),this.makeEllipse(),this.ellipseArray.push(this.ellipse),this.allobjArray.push(this.ellipse),this.ellipseinfoArray.push({point:this.ellipsePoints,info:this.markinfo}),this.realellipseinfoArray.push({point:this.realEllipsePoints,info:this.markinfo}),this.fabricObj.add(this.ellipse),this.ellipsePoints=[],this.realEllipsePoints=[],this.ellipse=null}if(void 0!=this.lastlabelArry.circle&&null!=this.lastlabelArry.circle)for(var u=function(i){console.log("circle",e.lastlabelArry.circle[i].point),e.markinfo=e.lastlabelArry.circle[i].info,e.findcolor(e.lastlabelArry.circle[i].info);var t={},o={};t["x"]=e.lastlabelArry.circle[i].point.x*e.scalewidth,t["y"]=e.lastlabelArry.circle[i].point.y*e.scaleheight,o["x"]=e.lastlabelArry.circle[i].point.x,o["y"]=e.lastlabelArry.circle[i].point.y;var l=new f["fabric"].Circle({radius:5,fill:e.markcolor,selectable:!1,hasBorders:!1,hasControls:!1,borderColor:"red",top:t.y-5,left:t.x-5});l.on("moved",(function(){console.log("aisojfgyaigvy7a98g",e.circleinfoArray[e.circleArray.indexOf(l)]),e.circleinfoArray[e.circleArray.indexOf(l)].point.x=l.left+5,e.circleinfoArray[e.circleArray.indexOf(l)].point.y=l.top+5,e.realcircleinfoArray[e.circleArray.indexOf(l)].point.x=(l.left+5)/e.scalewidth,e.realcircleinfoArray[e.circleArray.indexOf(l)].point.y=(l.top+5)/e.scaleheight})),l.type="point",l.color=e.markcolor,l.info=e.markinfo,e.circleArray.push(l),e.allobjArray.push(l),e.fabricObj.add(l),e.circleinfoArray.push({point:t,info:e.markinfo}),e.realcircleinfoArray.push({point:o,info:e.markinfo}),e.markinfo=null},m=0;m<this.lastlabelArry.circle.length;m++)u(m);this.fabricObj.renderAll(),this.fabricObj.hoverCursor="default",console.log("fabricobjuuu",this.fabricObj),console.log("polygonArrayuuu",this.polygonArray),console.log("polygoninfoArrayuuu",this.polygoninfoArray),console.log("realpolygoninfoArrayuuu",this.realpolygoninfoArray),console.log("realPointsuuu",this.realPoints),console.log("temlinesuuu",this.temlines),console.log("temlineCounteruuu",this.temlineCounter),console.log("lineArrayuuu",this.lineArray),console.log("lineinfoArrayuuu",this.lineinfoArray),console.log("reallineinfoArrayuuu",this.reallineinfoArray),console.log("circlearray",this.circleArray),console.log("circleinfoarray",this.circleinfoArray),console.log("realcircleinfoarray",this.realcircleinfoArray),console.log("polygonArrayuuu",this.polygonArray),console.log("polygonArrayuuu",this.polygonArray),console.log("polygonArrayuuu",this.polygonArray),console.log("allobjArrayuuu",this.allobjArray),this.emitfather()},createBackgroundImage:function(){var e=this;console.log(this.imagesrc),void 0!==this.imagesrc&&null!==this.imagesrc&&(this.fabricimageObj=new f["fabric"].Image.fromURL(this.imagesrc,(function(i){if(e.imagewidth=i.width,e.imageheight=i.height,e.scalewidth=1,e.scaleheight=1,i.width<.8*e.divWidth&&i.height<.8*e.divHeight)while(e.imagewidth<.8*e.divWidth&&e.imageheight<.8*e.divHeight)e.imagewidth*=1.1,e.imageheight*=1.1,e.scalewidth*=1.1,e.scaleheight*=1.1;if(i.width>e.divWidth||i.height>e.divHeight)while(e.imagewidth>e.divWidth||e.imageheight>e.divHeight)e.imagewidth/=1.1,e.imageheight/=1.1,e.scalewidth/=1.1,e.scaleheight/=1.1;e.distanceDelta=new f["fabric"].Point((e.divWidth-e.imagewidth)/2,(e.divHeight-e.imageheight)/2),e.fabricObj.setWidth(e.divWidth),e.fabricObj.setHeight(e.divHeight),console.log(i.width),console.log(i.height),console.log(e.imagewidth),console.log(e.imageheight),console.log(e.fabricObj.width),console.log(e.fabricObj.height),console.log(e.scalewidth),console.log(e.scaleheight),i.set({scaleX:e.scalewidth,scaleY:e.scaleheight,selectable:!0,hasControls:!1,left:0,top:0}),e.fabricObj.setBackgroundImage(i,e.fabricObj.renderAll.bind(e.fabricObj))})))},infotip:function(e){if(console.log("eotu23tu042982904823",this.testcirclearray,this.testcirclearray.length),!this.buttonmouseoveflag){var i=this.fabricObj.getObjects()[e];if(console.log("tesjiodshovdhsbsngs",i,i.type),"polygon"==i.type){var t=this.polygonArray.indexOf(i);console.log("index2",t),console.log(this.polygoninfoArray[t]),console.log(this.realpolygoninfoArray[t]),i.set({fill:"black"})}if("line"==i.type){console.log("islinein");var o=this.lineArray.indexOf(i);console.log(this.lineinfoArray[o]),console.log(this.reallineinfoArray[o]),i.set({stroke:"black"})}if("point"==i.type){console.log("ispointin");var l=this.circleArray.indexOf(i);console.log(this.circleinfoArray[l],l),console.log(this.realcircleinfoArray[l]),i.set({fill:"black"})}if("rectangle"==i.type){console.log("isrectanglein");var r=this.rectangleArray.indexOf(i);console.log(this.rectangleinfoArray[r],r),console.log(this.realrectangleinfoArray[r]),i.set({fill:"black"})}if("ellipse"==i.type){console.log("isellipsein");var s=this.ellipseArray.indexOf(i);console.log(this.ellipseinfoArray[s],s),console.log(this.realellipseinfoArray[s]),i.set({fill:"black"})}this.buttonmouseoveflag=!0,this.fabricObj.renderAll()}},removetip:function(e){if(this.buttonmouseoveflag){var i=this.markcolor;console.log("removetemproof!"),console.log("this.polygoninfoArray[index]!",this.polygoninfoArray[e]);var t=this.fabricObj.getObjects()[e];if("polygon"==t.type){var o=this.polygonArray.indexOf(t);this.findcolor(this.polygoninfoArray[o].info),t.fill=this.markcolor,this.markcolor=i}if("line"==t.type){console.log("islineout");var l=this.lineArray.indexOf(t);this.findcolor(this.lineinfoArray[l].info),t.set({stroke:this.markcolor}),this.markcolor=i}if("point"==t.type){console.log("ispointout");var r=this.circleArray.indexOf(t);this.findcolor(this.circleinfoArray[r].info),t.set({fill:this.markcolor}),this.markcolor=i}if("rectangle"==t.type){console.log("isrectangleout");var s=this.rectangleArray.indexOf(t);this.findcolor(this.rectangleinfoArray[s].info),t.set({fill:this.markcolor}),this.markcolor=i}if("ellipse"==t.type){console.log("isellipseout");var n=this.ellipseArray.indexOf(t);this.findcolor(this.ellipseinfoArray[n].info),t.set({fill:this.markcolor}),this.markcolor=i}this.buttonmouseoveflag=!1,this.fabricObj.renderAll()}},deletemarkedbi:function(){this.deletemarked(this.b_i)},deletemarked:function(e){if(!(e<0)){this.temitem&&this.deleteBorder(this.temitem);var i=this.fabricObj.getObjects()[e];if(console.log(i),"polygon"==i.type){var t=this.polygonArray.indexOf(i);this.fabricObj.remove(this.polygonArray[t]),this.polygonArray.splice(t,1),this.allobjArray.splice(e,1),this.polygoninfoArray.splice(t,1),this.realpolygoninfoArray.splice(t,1)}if("line"==i.type){var o=this.lineArray.indexOf(i);this.fabricObj.remove(this.lineArray[o]),this.fabricObj.remove(this.testcirclearray[2*o]),this.fabricObj.remove(this.testcirclearray[2*o+1]),this.testcirclearray.splice(2*o,2),this.lineArray.splice(o,1),this.allobjArray.splice(e,1),this.lineinfoArray.splice(o,1),this.reallineinfoArray.splice(o,1)}if("point"==i.type){var l=this.circleArray.indexOf(i);this.fabricObj.remove(this.circleArray[l]),this.circleArray.splice(l,1),this.allobjArray.splice(e,1),this.circleinfoArray.splice(l,1),this.realcircleinfoArray.splice(l,1)}if("rectangle"==i.type){var r=this.rectangleArray.indexOf(i);this.fabricObj.remove(this.rectangleArray[r]),this.rectangleArray.splice(r,1),this.allobjArray.splice(e,1),this.rectangleinfoArray.splice(r,1),this.realrectangleinfoArray.splice(r,1)}if("ellipse"==i.type){var s=this.ellipseArray.indexOf(i);this.fabricObj.remove(this.ellipseArray[s]),this.ellipseArray.splice(s,1),this.allobjArray.splice(e,1),this.ellipseinfoArray.splice(s,1),this.realellipseinfoArray.splice(s,1)}this.b_i=-1}},start:function(){"drag"==this.radio?(console.log("aaaa"),this.clearobj(),this.fabricObj.renderAll(),this.isimagechange&&this.Edit()):"polygonmark"==this.radio?(this.clearobj(),this.fabricObj.renderAll(),console.log("bbbb"),this.isimagechange&&this.Edit()):"linemark"==this.radio?(this.clearobj(),this.fabricObj.renderAll(),console.log("cccc"),this.isimagechange&&this.Edit()):"pointmark"==this.radio?(this.clearobj(),this.fabricObj.renderAll(),console.log("dddd"),this.isimagechange&&this.Edit()):"rectanglemark"==this.radio?(this.clearobj(),this.fabricObj.renderAll(),console.log("eeee"),this.isimagechange&&this.Edit()):"ellipsemark"==this.radio?(this.clearobj(),this.fabricObj.renderAll(),console.log("ffff"),this.isimagechange&&this.Edit()):(this.clearobj(),this.fabricObj.renderAll(),console.log("gggg"),this.Edit()),console.log(this.polygonArray),console.log(this.polygoninfoArray)},undo:function(){"polygonmark"==this.radio?this.roofPoints.length>0&&(1==this.roofPoints.length&&this.islabeling&&(this.emitfather(),this.islabeling=!1),this.fabricObj.remove(this.temlines[this.temlineCounter-1]),this.fabricObj.remove(this.temcircles[this.temcircleCounter-1]),this.roofPoints.pop(),this.realPoints.pop(),this.temlines.pop(),this.temcircles.pop(),this.temlineCounter--,this.temcircleCounter--,this.fabricObj.renderAll()):"linemark"==this.radio?this.testcirclearray.length%2==1&&this.testcirclearray.length>0&&(console.log("delete one"),this.testcirclearray.pop(),this.fabricObj.remove(this.llines[0]),this.llines.pop(),this.linePoints.pop(),this.realLinePoints.pop(),this.islabeling&&(this.emitfather(),this.islabeling=!1)):("rectanglemark"==this.radio&&1==this.rectanglePoints.length||"ellipsemark"==this.radio&&1==this.ellipsePoints.length)&&this.clearobj()},fabricEvent:function(){var e=this;this.fabricObj.on({"mouse:down":function(i){if(!e.isimagechange&&e.allowchangebi)if(null!=e.markinfo||"drag"==e.radio||1!=e.markstyle)if(i.absolutePointer.x>e.imagewidth||i.absolutePointer.y>e.imageheight||i.absolutePointer.x<0||i.absolutePointer.y<0)console.log("超出图片范围");else{if(console.log(i.e),console.log(e.fabricObj),"drag"==e.radio&&(console.log("1111"),e.panning=!0),"polygonmark"==e.radio)if(console.log("2222"),e.roofPoints.length<1||e.roofPoints.length>=1&&(i.absolutePointer.x!=e.roofPoints[e.roofPoints.length-1].x||i.absolutePointer.y!=e.roofPoints[e.roofPoints.length-1].y)){e.islabeling||(e.emitfather(),e.islabeling=!0);var t={},o={};t["x"]=i.absolutePointer.x,t["y"]=i.absolutePointer.y,o["x"]=i.absolutePointer.x/e.scalewidth,o["y"]=i.absolutePointer.y/e.scaleheight,e.roofPoints.push(t),e.realPoints.push(o);var l=[t.x,t.y,t.x,t.y];e.temlines.push(new f["fabric"].Line(l,{strokeWidth:3,selectable:!1,stroke:e.markcolor})),e.temcircles.push(new f["fabric"].Circle({radius:5,fill:e.markcolor,selectable:!1,top:t.y-5,left:t.x-5})),e.fabricObj.add(e.temcircles[e.temcircleCounter]),e.fabricObj.add(e.temlines[e.temlineCounter]),e.temcircleCounter++,e.temlineCounter++,console.log(e.roofPoints.length)}else console.log("click repeat!!!");if("linemark"==e.radio&&0==e.linePoints.length){console.log("3333"),e.islabeling||(e.emitfather(),e.islabeling=!0);var r={},s={};r["x"]=i.absolutePointer.x,r["y"]=i.absolutePointer.y,s["x"]=i.absolutePointer.x/e.scalewidth,s["y"]=i.absolutePointer.y/e.scaleheight,e.linePoints.push(r),e.realLinePoints.push(s);var n=[r.x,r.y,r.x,r.y];e.llines.push(new f["fabric"].Line(n,{strokeWidth:3,selectable:!1,hasBorders:!1,hasControls:!1,stroke:e.markcolor})),e.fabricObj.add(e.llines[0]),console.log("llinesddddd",e.llines),e.makeLineEndPoint(r)}else"linemark"==e.radio&&1==e.linePoints.length&&(1==e.markstyle?e.makeLineObj(i):(e.mousePointerEvent=i,console.log("dsadasdas",i),e.dialogleft=i.absolutePointer.x,e.dialogtop=String(i.absolutePointer.y),e.dialogVisible=!0));if("pointmark"==e.radio&&(1==e.markstyle?e.makePointObj(i):(e.mousePointerEvent=i,console.log("dsadasdas",i),e.dialogleft=i.absolutePointer.x,e.dialogtop=String(i.absolutePointer.y),e.dialogVisible=!0)),"rectanglemark"==e.radio&&0==e.rectanglePoints.length){console.log("6666"),e.islabeling||(e.emitfather(),e.islabeling=!0);var a={},c={};a["x"]=i.absolutePointer.x,a["y"]=i.absolutePointer.y,c["x"]=i.absolutePointer.x/e.scalewidth,c["y"]=i.absolutePointer.y/e.scaleheight,e.rectanglePoints.push(a),e.realRectanglePoints.push(c),e.temRectangle.push(new f["fabric"].Rect({left:a.x,top:a.y,fill:e.markcolor,width:0,height:0,hasControls:!1,selectable:!1})),e.temRectangle[0].oldleft=a.x,e.temRectangle[0].oldtop=a.y,e.fabricObj.add(e.temRectangle[0])}else"rectanglemark"==e.radio&&1==e.rectanglePoints.length&&(1==e.markstyle?e.makeRectangleObj(i):(e.mousePointerEvent=i,console.log("dsadasdas",i),e.dialogleft=i.absolutePointer.x,e.dialogtop=String(i.absolutePointer.y),e.dialogVisible=!0));if("ellipsemark"==e.radio&&0==e.ellipsePoints.length){console.log("ellipsemark11111"),e.islabeling||(e.emitfather(),e.islabeling=!0);var h={},g={};h["x"]=i.absolutePointer.x,h["y"]=i.absolutePointer.y,g["x"]=i.absolutePointer.x/e.scalewidth,g["y"]=i.absolutePointer.y/e.scaleheight,e.ellipsePoints.push(h),e.realEllipsePoints.push(g),e.temEllipse.push(new f["fabric"].Ellipse({left:h.x,top:h.y,fill:e.markcolor,rx:0,ry:0,hasControls:!1,selectable:!1})),e.temEllipse[0].oldleft=h.x,e.temEllipse[0].oldtop=h.y,e.fabricObj.add(e.temEllipse[0]),e.fabricObj.renderAll()}else"ellipsemark"==e.radio&&1==e.ellipsePoints.length&&(1==e.markstyle?e.makeEllipseObj(i):(e.mousePointerEvent=i,console.log("dsadasdas",i),e.dialogleft=i.absolutePointer.x,e.dialogtop=String(i.absolutePointer.y),e.dialogVisible=!0))}else e.$message({message:"您没有选中任何标签",type:"warning",duration:500})},"mouse:move":function(i){if(!e.isimagechange){if("drag"==e.radio&&e.panning&&i&&i.e){var t=new f["fabric"].Point(i.e.movementX,i.e.movementY);e.fabricObj.relativePan(t)}null!==e.temlines[0]&&void 0!==e.temlines[0]&&"polygonmark"==e.radio&&(e.x=i.absolutePointer.x,e.y=i.absolutePointer.y,e.temlines[e.temlineCounter-1].set({x2:e.x,y2:e.y}),e.fabricObj.renderAll()),null!==e.llines[0]&&void 0!==e.llines[0]&&"linemark"==e.radio&&(e.x=i.absolutePointer.x,e.y=i.absolutePointer.y,e.llines[0].set({x2:e.x,y2:e.y}),e.fabricObj.renderAll()),null!==e.temRectangle[0]&&void 0!==e.temRectangle[0]&&"rectanglemark"==e.radio&&(e.x=i.absolutePointer.x,e.y=i.absolutePointer.y,e.x>e.temRectangle[0].oldleft&&e.y>e.temRectangle[0].oldtop&&e.temRectangle[0].set({left:e.temRectangle[0].oldleft,top:e.temRectangle[0].oldtop,width:e.x-e.temRectangle[0].left,height:e.y-e.temRectangle[0].top}),e.x<e.temRectangle[0].oldleft&&e.y>e.temRectangle[0].oldtop&&e.temRectangle[0].set({left:e.x,top:e.temRectangle[0].oldtop,width:e.temRectangle[0].oldleft-e.x,height:e.y-e.temRectangle[0].top}),e.x>e.temRectangle[0].oldleft&&e.y<e.temRectangle[0].oldtop&&e.temRectangle[0].set({left:e.temRectangle[0].oldleft,top:e.y,width:e.x-e.temRectangle[0].left,height:e.temRectangle[0].oldtop-e.y}),e.x<e.temRectangle[0].oldleft&&e.y<e.temRectangle[0].oldtop&&e.temRectangle[0].set({left:e.x,top:e.y,width:e.temRectangle[0].oldleft-e.x,height:e.temRectangle[0].oldtop-e.y}),e.fabricObj.renderAll()),null!==e.temEllipse[0]&&void 0!==e.temEllipse[0]&&"ellipsemark"==e.radio&&(e.x=i.absolutePointer.x,e.y=i.absolutePointer.y,e.x>e.temEllipse[0].oldleft&&e.y>e.temEllipse[0].oldtop&&e.temEllipse[0].set({left:e.temEllipse[0].oldleft,top:e.temEllipse[0].oldtop,rx:(e.x-e.temEllipse[0].left)/2,ry:(e.y-e.temEllipse[0].top)/2}),e.x<e.temEllipse[0].oldleft&&e.y>e.temEllipse[0].oldtop&&e.temEllipse[0].set({left:e.x,top:e.temEllipse[0].oldtop,rx:(e.temEllipse[0].oldleft-e.x)/2,ry:(e.y-e.temEllipse[0].top)/2}),e.x>e.temEllipse[0].oldleft&&e.y<e.temEllipse[0].oldtop&&e.temEllipse[0].set({left:e.temEllipse[0].oldleft,top:e.y,rx:(e.x-e.temEllipse[0].left)/2,ry:(e.temEllipse[0].oldtop-e.y)/2}),e.x<e.temEllipse[0].oldleft&&e.y<e.temEllipse[0].oldtop&&e.temEllipse[0].set({left:e.x,top:e.y,rx:(e.temEllipse[0].oldleft-e.x)/2,ry:(e.temEllipse[0].oldtop-e.y)/2}),e.fabricObj.renderAll())}},"mouse:dblclick":function(i){"polygonmark"==e.radio&&(1==e.markstyle?(e.islabeling&&(e.emitfather(),e.islabeling=!1),console.log(e.roofPoints.length),e.makePolygon()):(console.log("dsadasdas",i),e.dialogleft=i.absolutePointer.x,e.dialogtop=String(i.absolutePointer.y),e.dialogVisible=!0))},"mouse:up":function(i){console.log("upupup"),"drag"==e.radio&&(e.panning=!1)}})},makePolygon:function(){var e=this;this.temlines.forEach((function(i){return e.fabricObj.remove(i)})),this.temcircles.forEach((function(i){return e.fabricObj.remove(i)})),this.roofPoints.length>2&&(this.makeRoof(),console.log(this.roof),this.fabricObj.add(this.roof),this.polygonArray.push(this.roof),this.allobjArray.push(this.roof),this.polygoninfoArray.push({point:this.roofPoints,info:this.markinfo}),this.realpolygoninfoArray.push({point:this.realPoints,info:this.markinfo})),this.fabricObj.renderAll(),console.log("double click"),this.roofPoints=[],this.realPoints=[],this.temlines=[],this.temcircles=[],this.temlineCounter=0,this.temcircleCounter=0},makeRoof:function(){var e=this.findLeftPaddingForRoof(this.roofPoints),i=this.findTopPaddingForRoof(this.roofPoints);console.log("!!!roofPoint",this.roofPoints),console.log("!!!fabricObj",this.fabricObj),this.roof=new f["fabric"].Polygon(this.roofPoints,{fill:this.markcolor,strokeWidth:5,selectable:!1,hasBorders:!1,borderColor:"red",lockMovementX:!0,lockMovementY:!0,objectCaching:!1,transparentCorners:!1,left:e,top:i}),this.roof.type="polygon",this.roof.color=this.markcolor,this.roof.info=this.markinfo,console.log("create!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",this.roof)},makeLineObj:function(e){if(e.absolutePointer.x!=this.linePoints[0].x||e.absolutePointer.y!=this.linePoints[0].y){var i={},t={};i["x"]=e.absolutePointer.x,i["y"]=e.absolutePointer.y,t["x"]=e.absolutePointer.x/this.scalewidth,t["y"]=e.absolutePointer.y/this.scaleheight,this.linePoints.push(i),this.realLinePoints.push(t),this.makeLineEndPoint(i),this.makeLine(this.linePoints),this.lineArray.push(this.line),this.allobjArray.splice(this.lineArray.length-1,0,this.line),this.lineinfoArray.push({point:this.linePoints,info:this.markinfo}),this.reallineinfoArray.push({point:this.realLinePoints,info:this.markinfo}),this.fabricObj.remove(this.llines[0]),this.fabricObj.add(this.line),console.log("this.fabricObj._objects",this.fabricObj._objects);for(var o=0;o<this.polygonArray.length+this.circleArray.length+this.rectangleArray.length;o++)this.fabricObj.getObjects()[this.fabricObj._objects.indexOf(this.line)].sendBackwards();this.fabricObj.renderAll(),this.linePoints=[],this.realLinePoints=[],this.line=null,this.llines=[],console.log("linearray",this.lineArray),console.log("lineinfoarray",this.lineinfoArray),console.log("reallineinfoarray",this.reallineinfoArray),console.log("llinesttttt",this.llines[0]),this.islabeling&&(this.emitfather(),this.islabeling=!1)}else console.log("click repeat!!!")},makeLine:function(e){console.log("alinePoints",e);var i=[e[0].x,e[0].y,e[1].x,e[1].y];this.line=new f["fabric"].Line(i,{strokeWidth:3,selectable:!1,hasBorders:!1,hasControls:!1,borderColor:"red",stroke:this.markcolor}),this.line.type="line",this.line.color=this.markcolor,this.line.info=this.markinfo,console.log("this.line",this.line)},makeLineEndPoint:function(e){var i=this,t=new f["fabric"].Circle({radius:5,fill:"green",selectable:!0,hasBorders:!1,hasControls:!1,top:e.y-5,left:e.x-5});t.bringToFront(),this.testcirclearray.length%2==0?(t.on("moving",(function(){i.lineArray[i.testcirclearray.indexOf(t)/2].set({x1:t.left+5,y1:t.top+5})})),t.on("moved",(function(){i.lineinfoArray[i.testcirclearray.indexOf(t)/2].point[0].x=t.left+5,i.lineinfoArray[i.testcirclearray.indexOf(t)/2].point[0].y=t.top+5,i.reallineinfoArray[i.testcirclearray.indexOf(t)/2].point[0].x=(t.left+5)/i.scalewidth,i.reallineinfoArray[i.testcirclearray.indexOf(t)/2].point[0].y=(t.top+5)/i.scaleheight}))):(t.on("moving",(function(){i.lineArray[(i.testcirclearray.indexOf(t)-1)/2].set({x2:t.left+5,y2:t.top+5})})),t.on("moved",(function(){i.lineinfoArray[(i.testcirclearray.indexOf(t)-1)/2].point[1].x=t.left+5,i.lineinfoArray[(i.testcirclearray.indexOf(t)-1)/2].point[1].y=t.top+5,i.reallineinfoArray[(i.testcirclearray.indexOf(t)-1)/2].point[1].x=(t.left+5)/i.scalewidth,i.reallineinfoArray[(i.testcirclearray.indexOf(t)-1)/2].point[1].y=(t.top+5)/i.scaleheight}))),this.testcirclearray.push(t)},makePointObj:function(e){var i=this;console.log("4444");var t={},o={};t["x"]=e.absolutePointer.x,t["y"]=e.absolutePointer.y,o["x"]=e.absolutePointer.x/this.scalewidth,o["y"]=e.absolutePointer.y/this.scaleheight;var l=new f["fabric"].Circle({radius:5,fill:this.markcolor,selectable:!1,hasBorders:!1,hasControls:!1,borderColor:"red",top:t.y-5,left:t.x-5});l.on("moved",(function(){i.circleinfoArray[i.circleArray.indexOf(l)].x=l.left+5,i.circleinfoArray[i.circleArray.indexOf(l)].y=l.top+5,i.realcircleinfoArray[i.circleArray.indexOf(l)].x=(l.left+5)/i.scalewidth,i.realcircleinfoArray[i.circleArray.indexOf(l)].y=(l.top+5)/i.scaleheight})),l.type="point",l.color=this.markcolor,l.info=this.markinfo,this.circleArray.push(l),this.allobjArray.push(l),this.circleinfoArray.push({point:t,info:this.markinfo}),this.realcircleinfoArray.push({point:o,info:this.markinfo}),this.fabricObj.add(l),this.fabricObj.renderAll(),console.log("circlearray",this.circleArray),console.log("circleinfoarray",this.circleinfoArray),console.log("realcircleinfoarray",this.realcircleinfoArray)},makeRectangleObj:function(e){if(e.absolutePointer.x!=this.rectanglePoints[0].x||e.absolutePointer.y!=this.rectanglePoints[0].y){console.log("dasiogfu890asdguyqehn fbewjkb fwekjb wef e eq");var i={},t={};i["x"]=e.absolutePointer.x,i["y"]=e.absolutePointer.y,t["x"]=e.absolutePointer.x/this.scalewidth,t["y"]=e.absolutePointer.y/this.scaleheight,this.rectanglePoints.push(i),this.realRectanglePoints.push(t),this.makeRectangle(),this.rectangleArray.push(this.rectangle),this.allobjArray.push(this.rectangle),this.rectangleinfoArray.push({point:this.rectanglePoints,info:this.markinfo}),this.realrectangleinfoArray.push({point:this.realRectanglePoints,info:this.markinfo}),this.fabricObj.remove(this.temRectangle[0]),this.fabricObj.add(this.rectangle),this.fabricObj.renderAll(),this.rectanglePoints=[],this.realRectanglePoints=[],this.rectangle=null,this.temRectangle=[],console.log("rectangleArray",this.rectangleArray),console.log("rectangleinfoArray",this.rectangleinfoArray),console.log("realrectangleinfoArray",this.realrectangleinfoArray),console.log("temRectangle",this.temRectangle[0]),this.islabeling&&(this.emitfather(),this.islabeling=!1)}else console.log("click repeat!!!")},makeRectangle:function(){if(console.log("rectanglePoints",this.rectanglePoints),this.rectanglePoints[0].x>this.rectanglePoints[1].x){var e=this.rectanglePoints[0].x;this.rectanglePoints[0].x=this.rectanglePoints[1].x,this.rectanglePoints[1].x=e}if(this.rectanglePoints[0].y>this.rectanglePoints[1].y){var i=this.rectanglePoints[0].y;this.rectanglePoints[0].y=this.rectanglePoints[1].y,this.rectanglePoints[1].y=i}if(this.realRectanglePoints[0].x>this.realRectanglePoints[1].x){var t=this.realRectanglePoints[0].x;this.realRectanglePoints[0].x=this.realRectanglePoints[1].x,this.realRectanglePoints[1].x=t}if(this.realRectanglePoints[0].y>this.realRectanglePoints[1].y){var o=this.realRectanglePoints[0].y;this.realRectanglePoints[0].y=this.realRectanglePoints[1].y,this.realRectanglePoints[1].y=o}var l=new f["fabric"].Rect({left:this.rectanglePoints[0].x,top:this.rectanglePoints[0].y,fill:this.markcolor,width:this.rectanglePoints[1].x-this.rectanglePoints[0].x,height:this.rectanglePoints[1].y-this.rectanglePoints[0].y,hasControls:!1,borderColor:"red",selectable:!1}),r=this;l.on("scaled",(function(){this.set({width:this.width*this.scaleX,height:this.height*this.scaleY,scaleX:1,scaleY:1}),console.log("suofangsuofang",this,r.rectangleinfoArray[r.rectangleArray.indexOf(this)],r.realrectangleinfoArray[r.rectangleArray.indexOf(this)]),r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].x=this.left,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].y=this.top,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].x=this.left+this.width,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].y=this.top+this.height,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].x=this.left/r.scalewidth,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].y=this.top/r.scaleheight,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].x=(this.left+this.width)/r.scalewidth,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].y=(this.top+this.height)/r.scaleheight})),l.on("moved",(function(){console.log("yidong",this,r.rectangleinfoArray[r.rectangleArray.indexOf(this)],r.realrectangleinfoArray[r.rectangleArray.indexOf(this)]),r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].x=this.left,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].y=this.top,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].x=this.left+this.width,r.rectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].y=this.top+this.height,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].x=this.left/r.scalewidth,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[0].y=this.top/r.scaleheight,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].x=(this.left+this.width)/r.scalewidth,r.realrectangleinfoArray[r.rectangleArray.indexOf(this)].point[1].y=(this.top+this.height)/r.scaleheight})),l.setControlsVisibility({mtr:!1}),l.type="rectangle",l.color=this.markcolor,l.info=this.markinfo,this.rectangle=l,console.log("this.rectangle",this.rectangle)},makeEllipseObj:function(e){if(e.absolutePointer.x!=this.ellipsePoints[0].x||e.absolutePointer.y!=this.ellipsePoints[0].y){var i={},t={};i["x"]=e.absolutePointer.x,i["y"]=e.absolutePointer.y,t["x"]=e.absolutePointer.x/this.scalewidth,t["y"]=e.absolutePointer.y/this.scaleheight,this.ellipsePoints.push(i),this.realEllipsePoints.push(t),this.makeEllipse(),this.ellipseArray.push(this.ellipse),this.allobjArray.push(this.ellipse),this.ellipseinfoArray.push({point:this.ellipsePoints,info:this.markinfo}),this.realellipseinfoArray.push({point:this.realEllipsePoints,info:this.markinfo}),this.fabricObj.remove(this.temEllipse[0]),this.fabricObj.add(this.ellipse),this.fabricObj.renderAll(),this.ellipsePoints=[],this.realEllipsePoints=[],this.ellipse=null,this.temEllipse=[],console.log("ellipseArray",this.ellipseArray),console.log("ellipseinfoArray",this.ellipseinfoArray),console.log("realellipseinfoArray",this.realellipseinfoArray),console.log("temEllipse",this.temEllipse[0]),this.islabeling&&(this.emitfather(),this.islabeling=!1)}else console.log("click repeat!!!")},makeEllipse:function(){if(console.log("ellipsePoints",this.ellipsePoints),this.ellipsePoints[0].x>this.ellipsePoints[1].x){var e=this.ellipsePoints[0].x;this.ellipsePoints[0].x=this.ellipsePoints[1].x,this.ellipsePoints[1].x=e}if(this.ellipsePoints[0].y>this.ellipsePoints[1].y){var i=this.ellipsePoints[0].y;this.ellipsePoints[0].y=this.ellipsePoints[1].y,this.ellipsePoints[1].y=i}if(this.ellipsePoints[0].x>this.ellipsePoints[1].x){var t=this.ellipsePoints[0].x;this.ellipsePoints[0].x=this.ellipsePoints[1].x,this.ellipsePoints[1].x=t}if(this.ellipsePoints[0].y>this.ellipsePoints[1].y){var o=this.ellipsePoints[0].y;this.ellipsePoints[0].y=this.ellipsePoints[1].y,this.ellipsePoints[1].y=o}var l=new f["fabric"].Ellipse({left:this.ellipsePoints[0].x,top:this.ellipsePoints[0].y,fill:this.markcolor,rx:(this.ellipsePoints[1].x-this.ellipsePoints[0].x)/2,ry:(this.ellipsePoints[1].y-this.ellipsePoints[0].y)/2,hasControls:!1,borderColor:"red",selectable:!1}),r=this;l.on("scaled",(function(){this.set({rx:this.rx*this.scaleX,ry:this.ry*this.scaleY,scaleX:1,scaleY:1}),console.log("suofangsuofang",this,r.ellipseinfoArray[r.ellipseArray.indexOf(this)],r.ellipseinfoArray[r.ellipseArray.indexOf(this)]),r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].x=this.left,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].y=this.top,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].x=this.left+2*this.rx,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].y=this.top+2*this.ry,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].x=this.left/r.scalewidth,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].y=this.top/r.scaleheight,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].x=(this.left+2*this.rx)/r.scalewidth,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].y=(this.top+2*this.ry)/r.scaleheight})),l.on("moved",(function(){console.log("yidong",this,r.ellipseinfoArray[r.ellipseArray.indexOf(this)],r.ellipseinfoArray[r.ellipseArray.indexOf(this)]),r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].x=this.left,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].y=this.top,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].x=this.left+2*this.rx,r.ellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].y=this.top+2*this.ry,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].x=this.left/r.scalewidth,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[0].y=this.top/r.scaleheight,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].x=(this.left+2*this.rx)/r.scalewidth,r.realellipseinfoArray[r.ellipseArray.indexOf(this)].point[1].y=(this.top+2*this.ry)/r.scaleheight})),l.setControlsVisibility({mtr:!1}),l.type="ellipse",l.color=this.markcolor,l.info=this.markinfo,this.ellipse=l,console.log("this.ellipse",this.ellipse)},findcolor:function(e){var i=this;this.premarktype.forEach((function(t){console.log("infind",e),t.name===e&&(console.log("find",t.color,Object(h["a"])(t.color)),i.markcolor=t.color)}))},findTopPaddingForRoof:function(e){for(var i=999999,t=0;t<this.roofPoints.length;t++)e[t].y<i&&(i=e[t].y);return Math.abs(i)},findLeftPaddingForRoof:function(e){for(var i=999999,t=0;t<this.roofPoints.length;t++)e[t].x<i&&(i=e[t].x);return Math.abs(i)}}},p=y,u=(t("e004"),t("2877")),m=Object(u["a"])(p,a,c,!1,null,"0a9e22cc",null),A=m.exports,v=(t("b775"),t("2c7b")),O=t("4360"),x=t("b6d5"),j=t("d28d");function k(e){console.log("keydown!!!!!!!!!!!!");var i=e.event||window.event,t=i.keyCode||i.which||i.charCode;83==t&&(console.log("ssssssssss!!!!!!!!!!!!!"),previousimage()),68==t&&(console.log("dddddddddd!!!!!!!!!!!!!"),nextimage()),70==t&&(console.log("ffffffffff!!!!!!!!!!!!!"),skipimagenext()),65==t&&(console.log("aaaaaaaaaa!!!!!!!!!!!!!"),skipimagepre()),71==t&&(console.log("gggggggggg!!!!!!!!!!!!!"),nomarkedimage()),46==t&&(console.log("ddddddddddelete!!!!!!!!!!!!!"),deleteSelect()),27==t&&(console.log("eeeeeeeeeeeeeeeeeeeeessssssssssccccccccccccccccccc!!!!!!!!!!!!!"),undochild())}var w={name:"Dashboard",data:function(){return{imageArry:[],infoArry:[],lastinfoArry:[],uuidArry:[],imagelargeArry:[],imageislabelArry:[],auditinfoArry:[],acceptinfoArry:[],testmarktype:[{name:"car",color:"rgba(128,0,0,0.75)"},{name:"person",color:"rgba(0,128,0,0.75)"},{name:"human1",color:"rgba(0,0,128,0.75)"},{name:"human2",color:"rgba(128,128,0,0.75)"},{name:"human3",color:"rgba(0,128,128,0.75)"},{name:"human4",color:"rgba(128,0,128,0.75)"}],marktype:[],nopnum:0,unable:!1,nownum:0,isalllabeled:!1,starttimer:null,nowseconds:0,isdisablebutton:!1,isimageview:!0,automarkbtntext:"开始自动标注",isloading:!1,isDestroy:!1}},components:{drawpolygon:A,miniimage:v["a"]},mounted:function(){var e=this;this.infoArry=new Array(this.imageArry.length),console.log("mounted!!!!",this.infoArry.length,this.infoArry),console.log("mounted!!!!uuid",O["a"].getters.uuid,"mounted!!!!store.getters.userid",O["a"].getters.userid),this.requireimage(),this.requiretag(),window.nextimage=this.nextimage,window.previousimage=this.previousimage,window.skipimagenext=this.skipimagenext,window.skipimagepre=this.skipimagepre,window.nomarkedimage=this.nomarkedimage,window.undochild=this.undochild,window.deleteSelect=this.deleteSelect,document.onkeydown=k,this.starttimer=setInterval((function(){if(e.nowseconds++,e.nowseconds>=6e4){console.log("超时");O["a"].getters.userId,O["a"].getters.dataSet.user_id,O["a"].getters.uuid;e.$store.dispatch("user/logout"),e.$router.push("/login?redirect=".concat(e.$route.fullPath)),location.reload()}}),1e3)},methods:{deleteSelect:function(){this.unable||(this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):this.$refs.drawpolygonref.deletemarkedbi())},undochild:function(){this.$refs.drawpolygonref.undo()},returndataset:function(){this.$router.go(-1)},entermark:function(e){console.log("faaaaaaaaaaaatherenter!"),this.nownum=e,this.isnowlabel1(),this.isimageview=!this.isimageview},returnimageview:function(){this.nopnum=0,this.$refs.drawpolygonref.saveinfo(!0,!1),this.nownum=0,this.isimageview=!this.isimageview},returnimageviewNoSave:function(){this.nopnum=0,this.nownum=0,this.isimageview=!this.isimageview},newlabel:function(){console.log("申请新图片")},nextimage:function(){this.unable||(this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):(this.nownum<this.imageArry.length&&(this.nopnum=1,this.unable=!0,this.$refs.drawpolygonref.saveinfo(!0,!1)),console.log("nextimage",this.nownum),console.log("nextimage infoArry",this.infoArry,this.infoArry.length)))},previousimage:function(){this.unable||(this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):(this.nownum>=0&&(this.nopnum=2,this.unable=!0,this.$refs.drawpolygonref.saveinfo(!0,!1)),console.log("previousimage",this.nownum)))},nomarkedimage:function(){this.unable||(this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):(this.nownum<this.imageArry.length&&(this.nopnum=1,this.unable=!0,this.$refs.drawpolygonref.saveinfo(!1,!1)),console.log("nextimage",this.nownum)))},skipimagenext:function(){this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):(this.nownum<this.imageArry.length-1?(this.$refs.drawpolygonref.saveinfo(!0,!0),this.nownum++):(this.$refs.drawpolygonref.saveinfo(!0,!0),this.returnimageviewNoSave()),console.log("skipimage",this.nownum),this.nowseconds=0)},skipimagepre:function(){this.isimageview?console.log("处于预览界面"):this.isdisablebutton?console.log("您现在正在修改图片"):(this.nownum>0?(this.$refs.drawpolygonref.saveinfo(!0,!0),this.nownum--):(this.$refs.drawpolygonref.saveinfo(!0,!0),this.returnimageviewNoSave()),console.log("skipimage",this.nownum),this.nowseconds=0)},closebutton:function(){console.log("fatherdisbtnnnnnnnnnnnnnnnnnnnnnnnnnnnn"),this.isdisablebutton=!this.isdisablebutton},isnowlabel1:function(){var e={uuid:this.uuidArry[this.nownum]};console.log(e),Object(x["c"])(e).then((function(e){console.log("isnowlabel",e)}))},saveimageinfo:function(e,i,t,o){this.infoArry[i]=e,console.log("save success",e,i),console.log("thisinfoArry",this.infoArry),this.savelabel1(this.nownum,t,o)},generateXML:function(){var e=this,i={dataset_id:O["a"].getters.uuid};e.$message({message:"开始生产json标注文件",duration:300,type:"success"}),Object(x["b"])(i).then((function(i){console.log(i),e.$message({message:"json标注文件生成成功",duration:300,type:"success"})})).catch((function(i){console.log("error",i),e.$message({message:"json标注文件生成失败",type:"error"})}))},requireimage:function(){console.log("uuid",O["a"].getters.uuid,"store.getters.userid",O["a"].getters.userid),console.log("store.getters.dataSet.role_type",O["a"].getters.dataSet.role_type,"store.getters.predictcontrol",O["a"].getters.predictcontrol);var e=this;this.isalllabeled=!0;var i={datasetuuid:O["a"].getters.uuid};Object(n["h"])(i).then((function(i){console.log("response",i),e.imageArry=[],e.infoArry=[],e.lastinfoArry=[],e.uuidArry=[],e.imagelargeArry=[],e.imageislabelArry=[],e.auditinfoArry=[],e.acceptinfoArry=[],console.log("get response.data.items",i.data.items);for(var t=0;t<i.data.items.length;t++){if(console.log("get items",[t],i.data.items[t]),e.auditinfoArry[t]=i.data.items[t].audit_remark,e.acceptinfoArry[t]=i.data.items[t].accept_remark,1!=i.data.items[t].is_label&&(e.isalllabeled=!1),void 0==i.data.items[t].label_data||"[]"===i.data.items[t].label_data)e.lastinfoArry.push({});else{var o=JSON.parse(i.data.items[t].label_data);console.log("tempa",o),e.lastinfoArry.push(o),console.log("lastinfoArry",e.lastinfoArry[t])}var l={};l["url"]=i.data.items[t].file_path,l["islabel"]=i.data.items[t].is_label,e.imagelargeArry.push(l),console.log("3ffafnzxvnkzjxc",e.imagelargeArry),e.uuidArry.push(i.data.items[t].uuid),e.imageArry.push(i.data.items[t].file_path),e.imageislabelArry.push(i.data.items[t].is_label)}console.log("imageislabelArry",e.imageislabelArry),console.log("_this.imageArry",e.imageArry),console.log("_this.lastinfoArry",e.lastinfoArry)})).catch((function(i){console.log("error",i),e.$message({message:"请求图片失败",type:"error"})}))},requiretag:function(){var e=this;this.marktype=[];var i={dataset_uuid:O["a"].getters.uuid};return Object(j["a"])(i).then((function(i){console.log("taggggggggggggggggggggggggggggggggggggg",i);for(var t=0;t<i.data.items.length;t++){var o={};o["name"]=i.data.items[t].name,o["color"]=i.data.items[t].color,e.marktype.push(o)}console.log("marktype",e.marktype)})).catch((function(i){console.log("error",i),e.$message({message:"请求标签集合失败",type:"error"})}))},savelabel1:function(e,i,t){var o=this;if(this.nowseconds=0,t){console.log("onlyislabel");var l={is_label:this.imageislabelArry[e],uuid:this.uuidArry[e],dataset_id:O["a"].getters.uuid};Object(x["d"])(l).then((function(e){console.log("change!!!!!!!!!!!!!!!!!!!!!!!",e),o.isDestroy||o.isnowlabel1()}))}else{console.log("put000no",e,this.infoArry[e]),console.log("put000",JSON.stringify(this.infoArry[e]));var r,s={dataSetId:O["a"].getters.uuid};Object(x["e"])(s).then((function(e){console.log("setUnAcceptsetUnAcceptsetUnAccept",e)})),r=this.infoArry[e].polygon.length>0||this.infoArry[e].line.length>0||this.infoArry[e].circle.length>0||this.infoArry[e].rectangle.length>0||this.infoArry[e].ellipse.length>0||!i?1:2;var n={label_data:JSON.stringify(this.infoArry[e]),is_label:r,uuid:this.uuidArry[e],dataset_id:O["a"].getters.uuid};Object(x["d"])(n).then((function(e){console.log(e),o.$message({message:"保存成功",duration:300,type:"success"}),o.requireimage(),o.requiretag().then((function(){console.log("thenthenthenthen"),1==o.nopnum&&(o.nownum<o.imageArry.length-1?(o.nownum++,o.isnowlabel1()):o.returnimageviewNoSave()),2==o.nopnum&&(o.nownum>0?(o.nownum--,o.isnowlabel1()):o.returnimageviewNoSave()),o.unable=!1}))})).catch((function(e){console.log("error",e),o.$message({message:"保存失败",type:"error"}),o.requireimage(),o.requiretag()}))}}},destroyed:function(){document.onkeydown=void 0,clearInterval(this.starttimer),this.starttimer=null,this.nowseconds=0,this.nownum>-1&&(this.isDestroy=!0,this.savelabel1(this.nownum,!0,!0))},computed:Object(r["a"])({},Object(s["b"])(["name"]))},P=w,_=(t("779e"),Object(u["a"])(P,o,l,!1,null,"726f71e0",null));i["default"]=_.exports},"779e":function(e,i,t){"use strict";t("7b6f")},"7b6f":function(e,i,t){},"7e1e":function(e,i,t){"use strict";t.d(i,"f",(function(){return l})),t.d(i,"c",(function(){return r})),t.d(i,"e",(function(){return s})),t.d(i,"h",(function(){return n})),t.d(i,"i",(function(){return a})),t.d(i,"a",(function(){return c})),t.d(i,"m",(function(){return h})),t.d(i,"k",(function(){return f})),t.d(i,"b",(function(){return g})),t.d(i,"l",(function(){return d})),t.d(i,"j",(function(){return b})),t.d(i,"d",(function(){return y}));var o=t("b775");function l(e){return Object(o["a"])({url:"/8085/data/getAssignedData",method:"get",params:e})}function r(e){return Object(o["a"])({url:"/8085/data/create",method:"post",params:e})}function s(e){return Object(o["a"])({url:"/8089/dataset/delete",method:"delete",params:e})}function n(e){return Object(o["a"])({url:"/8085/userlabel/getAll",method:"get",params:e})}function a(e){return Object(o["a"])({url:"/8085/userlabel/getLabel",method:"get",params:e})}function c(e){return Object(o["a"])({url:"/8085/userlabel/assignLabel",method:"post",params:e})}function h(e){return Object(o["a"])({url:"/8085/label/fresh",method:"put",params:e})}function f(e){return Object(o["a"])({url:"/8085/tag/get",method:"get",params:e})}function g(e){return Object(o["a"])({url:"/8085/userlabel/assignNewData",method:"post",params:e})}function d(e){return Object(o["a"])({url:"/8085/userlabel/reAssign",method:"post",params:e})}function b(e){return Object(o["a"])({url:"/8085/userlabel/getNewLabel",method:"get",params:e})}function y(e){return Object(o["a"])({url:"/8085/teamdataset/delTeam",method:"delete",params:e})}},"81d5":function(e,i,t){"use strict";var o=t("7b0b"),l=t("23cb"),r=t("50c4");e.exports=function(e){var i=o(this),t=r(i.length),s=arguments.length,n=l(s>1?arguments[1]:void 0,t),a=s>2?arguments[2]:void 0,c=void 0===a?t:l(a,t);while(c>n)i[n++]=e;return i}},b6d5:function(e,i,t){"use strict";t.d(i,"c",(function(){return l})),t.d(i,"d",(function(){return r})),t.d(i,"a",(function(){return s})),t.d(i,"b",(function(){return n})),t.d(i,"e",(function(){return a}));var o=t("b775");function l(e){return Object(o["a"])({url:"/8085/label/setLabeling",method:"post",params:e})}function r(e){return Object(o["a"])({url:"/8082/label",method:"put",data:e})}function s(e,i){return Object(o["a"])({url:"/8082/dataset/auto",method:"post",params:e,timeout:5e3*i})}function n(e){return Object(o["a"])({url:"/8082/dataset/save",method:"post",params:e})}function a(e){return Object(o["a"])({url:"/8085/data/setUnAccept",method:"put",params:e})}},bf71:function(e,i,t){},cb29:function(e,i,t){var o=t("23e7"),l=t("81d5"),r=t("44d2");o({target:"Array",proto:!0},{fill:l}),r("fill")},d28d:function(e,i,t){"use strict";t.d(i,"a",(function(){return l})),t.d(i,"b",(function(){return r})),t.d(i,"c",(function(){return s}));var o=t("b775");function l(e){return Object(o["a"])({url:"/8082/dataset/tag",method:"get",params:e})}function r(e){return Object(o["a"])({url:"/8085/tag/saveTags",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/8085/tag/updateTags",method:"put",data:e})}},d58f:function(e,i,t){var o=t("1c0b"),l=t("7b0b"),r=t("44ad"),s=t("50c4"),n=function(e){return function(i,t,n,a){o(t);var c=l(i),h=r(c),f=s(c.length),g=e?f-1:0,d=e?-1:1;if(n<2)while(1){if(g in h){a=h[g],g+=d;break}if(g+=d,e?g<0:f<=g)throw TypeError("Reduce of empty array with no initial value")}for(;e?g>=0:f>g;g+=d)g in h&&(a=t(a,h[g],g,c));return a}};e.exports={left:n(!1),right:n(!0)}},e004:function(e,i,t){"use strict";t("bf71")}}]);